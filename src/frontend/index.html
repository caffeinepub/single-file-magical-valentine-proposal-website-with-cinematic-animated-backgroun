<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Will You Be My Valentine? üíñ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, 
                oklch(0.25 0.15 320) 0%,
                oklch(0.35 0.18 340) 25%,
                oklch(0.45 0.12 350) 50%,
                oklch(0.35 0.15 330) 75%,
                oklch(0.25 0.12 310) 100%
            );
            position: relative;
            touch-action: pan-y;
            overscroll-behavior: none;
        }

        #backgroundCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        #introOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                oklch(0.2 0.18 320) 0%,
                oklch(0.3 0.2 340) 50%,
                oklch(0.2 0.15 310) 100%
            );
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
            transition: opacity 1s ease-out;
        }

        #introOverlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .intro-text {
            font-size: clamp(2rem, 6vw, 4rem);
            color: oklch(0.95 0.05 340);
            text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8),
                         0 0 60px oklch(0.6 0.25 330 / 0.6);
            animation: pulse 2s ease-in-out infinite;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        #mainContent {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease-in;
            touch-action: none;
        }

        #mainContent.visible {
            opacity: 1;
        }

        .glass-card {
            background: oklch(0.95 0.02 340 / 0.15);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid oklch(0.95 0.05 340 / 0.3);
            border-radius: 32px;
            padding: clamp(2rem, 5vw, 4rem);
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.4),
                        0 0 80px oklch(0.5 0.2 340 / 0.2),
                        inset 0 1px 0 oklch(1 0 0 / 0.2);
            max-width: 90%;
            width: 500px;
            text-align: center;
            position: relative;
            animation: cardGlow 3s ease-in-out infinite;
        }

        @keyframes cardGlow {
            0%, 100% { box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.4),
                        0 0 80px oklch(0.5 0.2 340 / 0.2),
                        inset 0 1px 0 oklch(1 0 0 / 0.2); }
            50% { box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.5),
                        0 0 100px oklch(0.5 0.25 340 / 0.3),
                        inset 0 1px 0 oklch(1 0 0 / 0.3); }
        }

        .proposal-text {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: oklch(0.98 0.03 340);
            margin-bottom: 2rem;
            font-weight: 300;
            text-shadow: 0 2px 20px oklch(0.5 0.2 340 / 0.5);
            line-height: 1.4;
        }

        .message-text {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            color: oklch(0.85 0.08 340);
            margin-bottom: 2rem;
            min-height: 2em;
            font-weight: 400;
            text-shadow: 0 1px 10px oklch(0.5 0.15 340 / 0.4);
        }

        .button-container {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            min-height: 80px;
        }

        .btn {
            padding: 1rem 3rem;
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px oklch(0.3 0.1 340 / 0.3);
            position: relative;
            letter-spacing: 0.02em;
            touch-action: none;
        }

        .btn-no {
            background: linear-gradient(135deg, oklch(0.65 0.15 340), oklch(0.55 0.18 330));
            color: oklch(0.98 0.02 340);
            position: fixed;
            transition: all 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            will-change: transform;
            z-index: 100;
        }

        .btn-no:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px oklch(0.5 0.2 340 / 0.5);
        }

        .btn-yes {
            background: linear-gradient(135deg, oklch(0.7 0.2 340), oklch(0.6 0.25 350));
            color: oklch(0.98 0.02 340);
            opacity: 0;
            transform: scale(0);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .btn-yes.visible {
            opacity: 1;
            transform: scale(1);
        }

        .btn-yes:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 40px oklch(0.6 0.25 340 / 0.6);
        }

        .final-message {
            font-size: clamp(1.3rem, 3.5vw, 2rem);
            color: oklch(0.98 0.03 340);
            text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8);
            animation: sparkle 2s ease-in-out infinite;
            line-height: 1.6;
        }

        @keyframes sparkle {
            0%, 100% { text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8); }
            50% { text-shadow: 0 0 50px oklch(0.7 0.25 340 / 1); }
        }

        .floating-decoration {
            position: fixed;
            font-size: 3rem;
            pointer-events: none;
            z-index: 5;
            animation: floatUp 3s ease-out forwards;
            opacity: 0;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) rotate(0deg); }
            100% { opacity: 0; transform: translateY(-200px) rotate(360deg); }
        }

        #adminPanel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: oklch(0.95 0.02 340 / 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid oklch(0.95 0.05 340 / 0.5);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.6);
            z-index: 2000;
            display: none;
            max-width: 90%;
            width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        #adminPanel.visible {
            display: block;
        }

        .admin-title {
            font-size: 1.8rem;
            color: oklch(0.3 0.15 340);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .admin-field {
            margin-bottom: 1.5rem;
        }

        .admin-label {
            display: block;
            font-size: 1rem;
            color: oklch(0.4 0.12 340);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .admin-input {
            width: 100%;
            padding: 0.8rem;
            font-size: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
            border-radius: 12px;
            background: oklch(0.98 0.01 340 / 0.8);
            color: oklch(0.2 0.1 340);
        }

        .admin-button {
            padding: 0.8rem 2rem;
            font-size: 1rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 1rem;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .admin-button-primary {
            background: linear-gradient(135deg, oklch(0.65 0.2 340), oklch(0.55 0.25 330));
            color: oklch(0.98 0.02 340);
        }

        .admin-button-secondary {
            background: oklch(0.85 0.05 340);
            color: oklch(0.3 0.15 340);
        }

        .admin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px oklch(0.5 0.2 340 / 0.4);
        }

        .share-link {
            background: oklch(0.95 0.02 340);
            padding: 0.8rem;
            border-radius: 8px;
            word-break: break-all;
            font-size: 0.9rem;
            color: oklch(0.3 0.12 340);
            margin-top: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
        }

        @media (max-width: 600px) {
            .glass-card {
                padding: 2rem 1.5rem;
            }
            
            .button-container {
                flex-direction: column;
                gap: 1rem;
                min-height: 100px;
            }

            .btn {
                width: 100%;
                max-width: 250px;
            }
        }
    </style>
</head>
<body>
    <canvas id="backgroundCanvas"></canvas>
    
    <div id="introOverlay">
        <div class="intro-text">Tap to Start ‚ú®</div>
    </div>

    <div id="mainContent">
        <div class="glass-card" id="mainCard">
            <div class="proposal-text" id="proposalText"></div>
            <div class="message-text" id="messageText"></div>
            <div class="button-container" id="buttonContainer">
                <button class="btn btn-no" id="noButton">No</button>
                <button class="btn btn-yes" id="yesButton">Yes</button>
            </div>
        </div>
    </div>

    <div id="adminPanel">
        <div class="admin-title">Admin Panel</div>
        <div class="admin-field">
            <label class="admin-label">Girlfriend Name</label>
            <input type="text" class="admin-input" id="adminGirlfriendName" />
        </div>
        <div class="admin-field">
            <label class="admin-label">Boyfriend Name</label>
            <input type="text" class="admin-input" id="adminBoyfriendName" />
        </div>
        <div class="admin-field">
            <label class="admin-label">Final Yes Message</label>
            <input type="text" class="admin-input" id="adminFinalMessage" />
        </div>
        <div class="admin-field">
            <label class="admin-label">Admin Password</label>
            <input type="password" class="admin-input" id="adminPassword" />
        </div>
        <button class="admin-button admin-button-primary" id="saveSettings">Save Settings</button>
        <button class="admin-button admin-button-secondary" id="generateLink">Generate Link</button>
        <button class="admin-button admin-button-secondary" id="closeAdmin">Close</button>
        <div id="shareLinkContainer"></div>
    </div>

    <script>
        // Settings management
        const DEFAULT_SETTINGS = {
            girlfriendName: 'Filizana',
            boyfriendName: 'Akash',
            finalMessage: 'I knew you would choose YES üíñ',
            adminPassword: '2026love'
        };

        let settings = { ...DEFAULT_SETTINGS };
        let audioContext = null;
        let backgroundMusic = null;
        let evadeCount = 0;
        let keyBuffer = '';
        let isEvading = false;
        const SECRET_KEYWORD = 'akash';
        const REQUIRED_EVADES = 7;
        const CUTE_MESSAGES = [
            'Really no?! ü•∫',
            'I can\'t believe this...',
            'You are beautiful and cute! üíï',
            'I\'m sorry, give me another chance! üôè',
            'Please reconsider... üíù',
            'Are you sure about that? üò¢',
            'My heart is breaking... üíî',
            'One more chance? üåπ'
        ];

        // Load settings from localStorage or URL
        function loadSettings() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const decoded = atob(dataParam);
                    const imported = JSON.parse(decoded);
                    settings = { ...DEFAULT_SETTINGS, ...imported };
                    localStorage.setItem('valentineSettings', JSON.stringify(settings));
                } catch (e) {
                    console.error('Failed to decode settings from URL');
                    const stored = localStorage.getItem('valentineSettings');
                    if (stored) {
                        try {
                            settings = { ...DEFAULT_SETTINGS, ...JSON.parse(stored) };
                        } catch (e2) {
                            console.error('Failed to parse stored settings');
                        }
                    }
                }
            } else {
                const stored = localStorage.getItem('valentineSettings');
                if (stored) {
                    try {
                        settings = { ...DEFAULT_SETTINGS, ...JSON.parse(stored) };
                    } catch (e) {
                        console.error('Failed to parse stored settings');
                    }
                }
            }
            
            updateUI();
        }

        function updateUI() {
            document.getElementById('proposalText').textContent = 
                `${settings.girlfriendName}, Will you be my Valentine?`;
        }

        // Populate admin panel with current settings
        function populateAdminPanel() {
            document.getElementById('adminGirlfriendName').value = settings.girlfriendName;
            document.getElementById('adminBoyfriendName').value = settings.boyfriendName;
            document.getElementById('adminFinalMessage').value = settings.finalMessage;
            document.getElementById('adminPassword').value = settings.adminPassword;
        }

        // Background music using uploaded audio file
        function initAudio() {
            try {
                backgroundMusic = new Audio();
                
                const sources = [
                    '/assets/forever.mp3',
                    '/assets/forever.mp4',
                    '/assets/forever-1.mp4'
                ];
                
                let currentSourceIndex = 0;
                
                backgroundMusic.loop = true;
                backgroundMusic.volume = 0;
                backgroundMusic.preload = 'auto';
                
                backgroundMusic.addEventListener('error', function(e) {
                    console.error('Audio load error for source:', sources[currentSourceIndex], e);
                    currentSourceIndex++;
                    if (currentSourceIndex < sources.length) {
                        console.log('Trying next audio source:', sources[currentSourceIndex]);
                        backgroundMusic.src = sources[currentSourceIndex];
                        backgroundMusic.load();
                    } else {
                        console.error('All audio sources failed to load. Continuing without background music.');
                    }
                });
                
                backgroundMusic.addEventListener('canplaythrough', function() {
                    console.log('Audio loaded successfully:', sources[currentSourceIndex]);
                }, { once: true });
                
                backgroundMusic.src = sources[currentSourceIndex];
                backgroundMusic.load();
                
            } catch (e) {
                console.error('Audio initialization failed:', e);
                backgroundMusic = null;
            }
        }

        function playBackgroundMusic() {
            if (!backgroundMusic) return;
            
            try {
                const playPromise = backgroundMusic.play();
                
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            console.log('Background music started successfully');
                            fadeInAudio(backgroundMusic, 0.3, 3000);
                        })
                        .catch(error => {
                            console.error('Playback failed:', error);
                        });
                }
            } catch (e) {
                console.error('Background music play error:', e);
            }
        }

        function fadeInAudio(audioElement, targetVolume, duration) {
            if (!audioElement) return;
            
            const steps = 50;
            const stepDuration = duration / steps;
            const volumeIncrement = targetVolume / steps;
            let currentStep = 0;
            
            const fadeInterval = setInterval(() => {
                if (currentStep >= steps) {
                    clearInterval(fadeInterval);
                    audioElement.volume = targetVolume;
                    return;
                }
                
                audioElement.volume = Math.min(volumeIncrement * currentStep, targetVolume);
                currentStep++;
            }, stepDuration);
        }

        // Get safe viewport bounds accounting for mobile visual viewport
        function getViewportBounds() {
            const vw = window.visualViewport ? window.visualViewport.width : window.innerWidth;
            const vh = window.visualViewport ? window.visualViewport.height : window.innerHeight;
            return { width: vw, height: vh };
        }

        // Clamp No button position to stay fully within viewport
        function clampPositionToViewport(x, y, buttonWidth, buttonHeight) {
            const viewport = getViewportBounds();
            const padding = 20; // Safe padding from edges
            
            // Clamp X position
            const minX = padding;
            const maxX = viewport.width - buttonWidth - padding;
            const clampedX = Math.max(minX, Math.min(x, maxX));
            
            // Clamp Y position
            const minY = padding;
            const maxY = viewport.height - buttonHeight - padding;
            const clampedY = Math.max(minY, Math.min(y, maxY));
            
            return { x: clampedX, y: clampedY };
        }

        // Move No button to a safe random position
        function evadeNoButton() {
            if (isEvading || evadeCount >= REQUIRED_EVADES) return;
            
            isEvading = true;
            const noButton = document.getElementById('noButton');
            const rect = noButton.getBoundingClientRect();
            const viewport = getViewportBounds();
            
            // Generate random position
            const randomX = Math.random() * (viewport.width - rect.width);
            const randomY = Math.random() * (viewport.height - rect.height);
            
            // Clamp to safe viewport bounds
            const safePos = clampPositionToViewport(randomX, randomY, rect.width, rect.height);
            
            // Apply position
            noButton.style.left = `${safePos.x}px`;
            noButton.style.top = `${safePos.y}px`;
            
            // Update message
            evadeCount++;
            const messageIndex = Math.min(evadeCount - 1, CUTE_MESSAGES.length - 1);
            document.getElementById('messageText').textContent = CUTE_MESSAGES[messageIndex];
            
            // Play sound effect
            playSound('evade');
            
            // Check if we've reached required evades
            if (evadeCount >= REQUIRED_EVADES) {
                setTimeout(() => {
                    noButton.style.display = 'none';
                    document.getElementById('yesButton').classList.add('visible');
                    document.getElementById('messageText').textContent = 'Now you have only one choice... üíù';
                    playSound('reveal');
                }, 300);
            }
            
            setTimeout(() => {
                isEvading = false;
            }, 250);
        }

        // Initialize No button position
        function initializeNoButtonPosition() {
            const noButton = document.getElementById('noButton');
            const buttonContainer = document.getElementById('buttonContainer');
            const containerRect = buttonContainer.getBoundingClientRect();
            
            // Start in center of button container
            const centerX = containerRect.left + (containerRect.width / 2) - (noButton.offsetWidth / 2);
            const centerY = containerRect.top + (containerRect.height / 2) - (noButton.offsetHeight / 2);
            
            noButton.style.left = `${centerX}px`;
            noButton.style.top = `${centerY}px`;
        }

        // Re-clamp button position on resize/orientation change
        function handleResize() {
            if (evadeCount > 0 && evadeCount < REQUIRED_EVADES) {
                const noButton = document.getElementById('noButton');
                const rect = noButton.getBoundingClientRect();
                const currentX = parseFloat(noButton.style.left) || rect.left;
                const currentY = parseFloat(noButton.style.top) || rect.top;
                
                const safePos = clampPositionToViewport(currentX, currentY, rect.width, rect.height);
                noButton.style.left = `${safePos.x}px`;
                noButton.style.top = `${safePos.y}px`;
            }
        }

        // Sound effects
        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                if (type === 'evade') {
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } else if (type === 'reveal') {
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } else if (type === 'yes') {
                    oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                }
            } catch (e) {
                console.error('Sound effect error:', e);
            }
        }

        // Floating hearts animation
        function createFloatingHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'floating-decoration';
            heart.textContent = 'üíñ';
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;
            document.body.appendChild(heart);
            
            setTimeout(() => {
                heart.remove();
            }, 3000);
        }

        // Canvas background animation
        function initCanvas() {
            const canvas = document.getElementById('backgroundCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const particles = [];
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 2 + 1,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    opacity: Math.random() * 0.5 + 0.2
                });
            }
            
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    
                    if (particle.x < 0 || particle.x > canvas.width) particle.vx *= -1;
                    if (particle.y < 0 || particle.y > canvas.height) particle.vy *= -1;
                    
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 182, 193, ${particle.opacity})`;
                    ctx.fill();
                });
                
                requestAnimationFrame(animate);
            }
            
            animate();
            
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // Event listeners
        document.getElementById('introOverlay').addEventListener('click', function() {
            this.classList.add('hidden');
            document.getElementById('mainContent').classList.add('visible');
            playBackgroundMusic();
            initializeNoButtonPosition();
        });

        // No button evasion - unified handler for all interaction types
        const noButton = document.getElementById('noButton');
        
        // Desktop: mouseenter
        noButton.addEventListener('mouseenter', function(e) {
            if (evadeCount < REQUIRED_EVADES) {
                evadeNoButton();
            }
        });
        
        // Mobile/Touch: touchstart
        noButton.addEventListener('touchstart', function(e) {
            e.preventDefault();
            if (evadeCount < REQUIRED_EVADES) {
                evadeNoButton();
            }
        }, { passive: false });
        
        // Fallback: click (in case hover/touch doesn't trigger)
        noButton.addEventListener('click', function(e) {
            e.preventDefault();
            if (evadeCount < REQUIRED_EVADES) {
                evadeNoButton();
            }
        });

        // Yes button
        document.getElementById('yesButton').addEventListener('click', function() {
            playSound('yes');
            
            const mainCard = document.getElementById('mainCard');
            mainCard.innerHTML = `
                <div class="final-message">
                    ${settings.finalMessage}<br><br>
                    üíï ${settings.boyfriendName} üíï
                </div>
            `;
            
            // Create multiple floating hearts
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    createFloatingHeart(x, y);
                }, i * 100);
            }
        });

        // Admin panel secret keyword
        document.addEventListener('keypress', function(e) {
            keyBuffer += e.key.toLowerCase();
            if (keyBuffer.length > SECRET_KEYWORD.length) {
                keyBuffer = keyBuffer.slice(-SECRET_KEYWORD.length);
            }
            
            if (keyBuffer === SECRET_KEYWORD) {
                document.getElementById('adminPanel').classList.add('visible');
                populateAdminPanel();
                keyBuffer = '';
            }
        });

        // Admin panel controls
        document.getElementById('saveSettings').addEventListener('click', function() {
            const password = document.getElementById('adminPassword').value;
            
            if (password !== settings.adminPassword && password !== DEFAULT_SETTINGS.adminPassword) {
                alert('Incorrect password!');
                return;
            }
            
            settings.girlfriendName = document.getElementById('adminGirlfriendName').value;
            settings.boyfriendName = document.getElementById('adminBoyfriendName').value;
            settings.finalMessage = document.getElementById('adminFinalMessage').value;
            settings.adminPassword = password;
            
            localStorage.setItem('valentineSettings', JSON.stringify(settings));
            updateUI();
            alert('Settings saved!');
        });

        document.getElementById('generateLink').addEventListener('click', function() {
            const password = document.getElementById('adminPassword').value;
            
            if (password !== settings.adminPassword && password !== DEFAULT_SETTINGS.adminPassword) {
                alert('Incorrect password!');
                return;
            }
            
            const dataToShare = {
                girlfriendName: document.getElementById('adminGirlfriendName').value,
                boyfriendName: document.getElementById('adminBoyfriendName').value,
                finalMessage: document.getElementById('adminFinalMessage').value
            };
            
            const encoded = btoa(JSON.stringify(dataToShare));
            const shareUrl = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
            
            const container = document.getElementById('shareLinkContainer');
            container.innerHTML = `
                <div class="share-link">
                    <strong>Share this link:</strong><br>
                    ${shareUrl}
                </div>
            `;
        });

        document.getElementById('closeAdmin').addEventListener('click', function() {
            document.getElementById('adminPanel').classList.remove('visible');
        });

        // Handle resize and orientation changes
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', () => {
            setTimeout(handleResize, 100);
        });

        // Initialize
        loadSettings();
        initAudio();
        initCanvas();
    </script>
</body>
</html>
