<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Will You Be My Valentine? üíñ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, 
                oklch(0.25 0.15 320) 0%,
                oklch(0.35 0.18 340) 25%,
                oklch(0.45 0.12 350) 50%,
                oklch(0.35 0.15 330) 75%,
                oklch(0.25 0.12 310) 100%
            );
            position: relative;
            touch-action: pan-y;
            overscroll-behavior: none;
        }

        #backgroundCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* Valentine Decorations */
        .cat-decoration {
            position: fixed;
            bottom: 20px;
            width: 80px;
            height: 80px;
            z-index: 5;
            pointer-events: none;
            animation: catBounce 3s ease-in-out infinite;
        }

        .cat-left {
            left: 20px;
        }

        .cat-right {
            right: 20px;
            animation-delay: 1.5s;
        }

        @keyframes catBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .chocolate-decoration {
            position: fixed;
            width: 40px;
            height: 40px;
            z-index: 5;
            pointer-events: none;
            opacity: 0.8;
        }

        .chocolate-1 {
            top: 15%;
            left: 10%;
            animation: floatChocolate 8s ease-in-out infinite;
        }

        .chocolate-2 {
            top: 25%;
            right: 15%;
            animation: floatChocolate 10s ease-in-out infinite 2s;
        }

        .chocolate-3 {
            bottom: 30%;
            left: 8%;
            animation: floatChocolate 12s ease-in-out infinite 4s;
        }

        @keyframes floatChocolate {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, -20px) rotate(90deg); }
            50% { transform: translate(0, -40px) rotate(180deg); }
            75% { transform: translate(-20px, -20px) rotate(270deg); }
        }

        .teddy-decoration {
            position: fixed;
            top: 10%;
            right: 5%;
            width: 100px;
            height: 100px;
            z-index: 5;
            pointer-events: none;
            animation: teddyHug 4s ease-in-out infinite;
        }

        @keyframes teddyHug {
            0%, 100% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        /* Bottom-right image frame */
        #photoFrame {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 200px;
            background: oklch(0.95 0.02 340 / 0.2);
            backdrop-filter: blur(15px) saturate(180%);
            border: 2px solid oklch(0.95 0.05 340 / 0.4);
            border-radius: 16px;
            padding: 8px;
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.5),
                        0 0 60px oklch(0.5 0.2 340 / 0.3);
            z-index: 500;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.8) translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        #photoFrame.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
        }

        #photoFrame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 4px 16px oklch(0.1 0.1 320 / 0.4);
        }

        #introOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                oklch(0.2 0.18 320) 0%,
                oklch(0.3 0.2 340) 50%,
                oklch(0.2 0.15 310) 100%
            );
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
            transition: opacity 1s ease-out;
        }

        #introOverlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .intro-text {
            font-size: clamp(2rem, 6vw, 4rem);
            color: oklch(0.95 0.05 340);
            text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8),
                         0 0 60px oklch(0.6 0.25 330 / 0.6);
            animation: pulse 2s ease-in-out infinite;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        #mainContent {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease-in;
            touch-action: none;
        }

        #mainContent.visible {
            opacity: 1;
        }

        .glass-card {
            background: oklch(0.95 0.02 340 / 0.15);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid oklch(0.95 0.05 340 / 0.3);
            border-radius: 32px;
            padding: clamp(2rem, 5vw, 4rem);
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.4),
                        0 0 80px oklch(0.5 0.2 340 / 0.2),
                        inset 0 1px 0 oklch(1 0 0 / 0.2);
            max-width: 90%;
            width: 500px;
            text-align: center;
            position: relative;
            animation: cardGlow 3s ease-in-out infinite;
        }

        @keyframes cardGlow {
            0%, 100% { box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.4),
                        0 0 80px oklch(0.5 0.2 340 / 0.2),
                        inset 0 1px 0 oklch(1 0 0 / 0.2); }
            50% { box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.5),
                        0 0 100px oklch(0.5 0.25 340 / 0.3),
                        inset 0 1px 0 oklch(1 0 0 / 0.3); }
        }

        .proposal-text {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: oklch(0.98 0.03 340);
            margin-bottom: 2rem;
            font-weight: 300;
            text-shadow: 0 2px 20px oklch(0.5 0.2 340 / 0.5);
            line-height: 1.4;
        }

        .message-text {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            color: oklch(0.85 0.08 340);
            margin-bottom: 2rem;
            min-height: 2em;
            font-weight: 400;
            text-shadow: 0 1px 10px oklch(0.5 0.15 340 / 0.4);
        }

        .button-container {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            min-height: 80px;
        }

        .btn {
            padding: 1rem 3rem;
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px oklch(0.3 0.1 340 / 0.3);
            position: relative;
            letter-spacing: 0.02em;
            touch-action: none;
        }

        .btn-no {
            background: linear-gradient(135deg, oklch(0.65 0.15 340), oklch(0.55 0.18 330));
            color: oklch(0.98 0.02 340);
            position: fixed;
            transition: left 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                        top 0.2s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            will-change: transform;
            z-index: 100;
        }

        .btn-no:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px oklch(0.5 0.2 340 / 0.5);
        }

        .btn-yes {
            background: linear-gradient(135deg, oklch(0.7 0.2 340), oklch(0.6 0.25 350));
            color: oklch(0.98 0.02 340);
            opacity: 0;
            transform: scale(0);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .btn-yes.visible {
            opacity: 1;
            transform: scale(1);
        }

        .btn-yes:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 40px oklch(0.6 0.25 340 / 0.6);
        }

        .final-message {
            font-size: clamp(1.3rem, 3.5vw, 2rem);
            color: oklch(0.98 0.03 340);
            text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8);
            animation: sparkle 2s ease-in-out infinite;
            line-height: 1.6;
        }

        @keyframes sparkle {
            0%, 100% { text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8); }
            50% { text-shadow: 0 0 50px oklch(0.7 0.25 340 / 1); }
        }

        .floating-decoration {
            position: fixed;
            font-size: 3rem;
            pointer-events: none;
            z-index: 5;
            animation: floatUp 3s ease-out forwards;
            opacity: 0;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) rotate(0deg); }
            100% { opacity: 0; transform: translateY(-200px) rotate(360deg); }
        }

        #adminPanel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: oklch(0.95 0.02 340 / 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid oklch(0.95 0.05 340 / 0.5);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.6);
            z-index: 2000;
            display: none;
            max-width: 90%;
            width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        #adminPanel.visible {
            display: block;
        }

        .admin-title {
            font-size: 1.8rem;
            color: oklch(0.3 0.15 340);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .admin-field {
            margin-bottom: 1.5rem;
        }

        .admin-label {
            display: block;
            font-size: 1rem;
            color: oklch(0.4 0.12 340);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .admin-input {
            width: 100%;
            padding: 0.8rem;
            font-size: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
            border-radius: 12px;
            background: oklch(0.98 0.01 340 / 0.8);
            color: oklch(0.2 0.1 340);
        }

        .admin-button {
            padding: 0.8rem 2rem;
            font-size: 1rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 1rem;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .admin-button-primary {
            background: linear-gradient(135deg, oklch(0.65 0.2 340), oklch(0.55 0.25 330));
            color: oklch(0.98 0.02 340);
        }

        .admin-button-secondary {
            background: oklch(0.85 0.05 340);
            color: oklch(0.3 0.15 340);
        }

        .admin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px oklch(0.5 0.2 340 / 0.4);
        }

        .share-link {
            background: oklch(0.95 0.02 340);
            padding: 0.8rem;
            border-radius: 8px;
            word-break: break-all;
            font-size: 0.9rem;
            color: oklch(0.3 0.12 340);
            margin-top: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
        }

        @media (max-width: 600px) {
            .glass-card {
                padding: 2rem 1.5rem;
            }
            
            .button-container {
                flex-direction: column;
                gap: 1rem;
                min-height: 100px;
            }

            .btn {
                width: 100%;
                max-width: 250px;
            }

            .cat-decoration {
                width: 60px;
                height: 60px;
            }

            .teddy-decoration {
                width: 70px;
                height: 70px;
            }

            .chocolate-decoration {
                width: 30px;
                height: 30px;
            }

            #photoFrame {
                width: 150px;
                height: 150px;
                bottom: 15px;
                right: 15px;
            }
        }
    </style>
</head>
<body>
    <canvas id="backgroundCanvas"></canvas>
    
    <!-- Valentine Decorations -->
    <svg class="cat-decoration cat-left" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="catGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:oklch(0.75 0.15 30);stop-opacity:1" />
                <stop offset="100%" style="stop-color:oklch(0.65 0.18 25);stop-opacity:1" />
            </linearGradient>
        </defs>
        <!-- Cat body -->
        <ellipse cx="50" cy="60" rx="25" ry="20" fill="url(#catGradient)"/>
        <!-- Cat head -->
        <circle cx="50" cy="35" r="18" fill="url(#catGradient)"/>
        <!-- Ears -->
        <path d="M 35 25 L 30 15 L 40 20 Z" fill="url(#catGradient)"/>
        <path d="M 65 25 L 70 15 L 60 20 Z" fill="url(#catGradient)"/>
        <!-- Eyes -->
        <circle cx="43" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="57" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <!-- Nose -->
        <circle cx="50" cy="40" r="2" fill="oklch(0.6 0.2 10)"/>
        <!-- Whiskers -->
        <line x1="30" y1="38" x2="20" y2="36" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <line x1="30" y1="42" x2="20" y2="44" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <line x1="70" y1="38" x2="80" y2="36" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <line x1="70" y1="42" x2="80" y2="44" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <!-- Tail -->
        <path d="M 70 65 Q 85 60 90 70" stroke="url(#catGradient)" stroke-width="4" fill="none" stroke-linecap="round"/>
    </svg>

    <svg class="cat-decoration cat-right" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="catGradient2" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:oklch(0.8 0.12 340);stop-opacity:1" />
                <stop offset="100%" style="stop-color:oklch(0.7 0.15 335);stop-opacity:1" />
            </linearGradient>
        </defs>
        <!-- Cat body -->
        <ellipse cx="50" cy="60" rx="25" ry="20" fill="url(#catGradient2)"/>
        <!-- Cat head -->
        <circle cx="50" cy="35" r="18" fill="url(#catGradient2)"/>
        <!-- Ears -->
        <path d="M 35 25 L 30 15 L 40 20 Z" fill="url(#catGradient2)"/>
        <path d="M 65 25 L 70 15 L 60 20 Z" fill="url(#catGradient2)"/>
        <!-- Eyes -->
        <circle cx="43" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="57" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <!-- Nose -->
        <circle cx="50" cy="40" r="2" fill="oklch(0.6 0.2 10)"/>
        <!-- Whiskers -->
        <line x1="30" y1="38" x2="20" y2="36" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <line x1="30" y1="42" x2="20" y2="44" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <line x1="70" y1="38" x2="80" y2="36" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <line x1="70" y1="42" x2="80" y2="44" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <!-- Tail -->
        <path d="M 30 65 Q 15 60 10 70" stroke="url(#catGradient2)" stroke-width="4" fill="none" stroke-linecap="round"/>
    </svg>

    <!-- Chocolates -->
    <svg class="chocolate-decoration chocolate-1" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="10" width="40" height="30" rx="5" fill="oklch(0.35 0.08 30)"/>
        <rect x="10" y="15" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
        <rect x="27" y="15" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
        <rect x="10" y="27" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
        <rect x="27" y="27" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
    </svg>

    <svg class="chocolate-decoration chocolate-2" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <circle cx="25" cy="25" r="20" fill="oklch(0.4 0.1 25)"/>
        <circle cx="25" cy="25" r="15" fill="oklch(0.5 0.12 30)"/>
        <path d="M 25 10 L 28 20 L 38 20 L 30 27 L 33 37 L 25 30 L 17 37 L 20 27 L 12 20 L 22 20 Z" fill="oklch(0.7 0.15 40)"/>
    </svg>

    <svg class="chocolate-decoration chocolate-3" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <path d="M 25 5 L 30 15 L 42 17 L 33 26 L 35 38 L 25 32 L 15 38 L 17 26 L 8 17 L 20 15 Z" fill="oklch(0.38 0.09 28)"/>
        <circle cx="25" cy="25" r="8" fill="oklch(0.55 0.13 35)"/>
    </svg>

    <!-- Teddy Bear with Heart -->
    <svg class="teddy-decoration" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="teddyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:oklch(0.65 0.12 35);stop-opacity:1" />
                <stop offset="100%" style="stop-color:oklch(0.55 0.15 30);stop-opacity:1" />
            </linearGradient>
        </defs>
        <!-- Body -->
        <ellipse cx="60" cy="75" rx="25" ry="30" fill="url(#teddyGradient)"/>
        <!-- Head -->
        <circle cx="60" cy="40" r="22" fill="url(#teddyGradient)"/>
        <!-- Ears -->
        <circle cx="45" cy="25" r="10" fill="url(#teddyGradient)"/>
        <circle cx="75" cy="25" r="10" fill="url(#teddyGradient)"/>
        <!-- Arms -->
        <ellipse cx="38" cy="70" rx="8" ry="18" fill="url(#teddyGradient)" transform="rotate(-20 38 70)"/>
        <ellipse cx="82" cy="70" rx="8" ry="18" fill="url(#teddyGradient)" transform="rotate(20 82 70)"/>
        <!-- Legs -->
        <ellipse cx="50" cy="100" rx="10" ry="15" fill="url(#teddyGradient)"/>
        <ellipse cx="70" cy="100" rx="10" ry="15" fill="url(#teddyGradient)"/>
        <!-- Face -->
        <circle cx="52" cy="38" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="68" cy="38" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="60" cy="45" r="2.5" fill="oklch(0.3 0.1 30)"/>
        <!-- Heart -->
        <path d="M 60 85 L 55 80 Q 50 75 50 70 Q 50 65 55 65 Q 60 65 60 70 Q 60 65 65 65 Q 70 65 70 70 Q 70 75 65 80 Z" fill="oklch(0.65 0.25 10)" opacity="0.9"/>
    </svg>

    <!-- Bottom-right photo frame -->
    <div id="photoFrame">
        <img src="/assets/IMG_20221213_093702.jpg" alt="Special Memory" />
    </div>

    <div id="introOverlay">
        <div class="intro-text">Tap to Start ‚ú®</div>
    </div>

    <div id="mainContent">
        <div class="glass-card" id="mainCard">
            <div class="proposal-text" id="proposalText"></div>
            <div class="message-text" id="messageText"></div>
            <div class="button-container" id="buttonContainer">
                <button class="btn btn-no" id="noButton">No</button>
                <button class="btn btn-yes" id="yesButton">Yes</button>
            </div>
        </div>
    </div>

    <div id="adminPanel">
        <div class="admin-title">Admin Panel</div>
        <div class="admin-field">
            <label class="admin-label">Girlfriend Name</label>
            <input type="text" class="admin-input" id="adminGirlfriendName" />
        </div>
        <div class="admin-field">
            <label class="admin-label">Boyfriend Name</label>
            <input type="text" class="admin-input" id="adminBoyfriendName" />
        </div>
        <div class="admin-field">
            <label class="admin-label">Final Yes Message</label>
            <input type="text" class="admin-input" id="adminFinalMessage" />
        </div>
        <div class="admin-field">
            <label class="admin-label">Admin Password</label>
            <input type="password" class="admin-input" id="adminPassword" />
        </div>
        <button class="admin-button admin-button-primary" id="saveSettings">Save Settings</button>
        <button class="admin-button admin-button-secondary" id="generateLink">Generate Link</button>
        <button class="admin-button admin-button-secondary" id="closeAdmin">Close</button>
        <div id="shareLinkContainer"></div>
    </div>

    <script>
        // Configuration
        const ADMIN_PASSWORD = 'valentine2024';
        const MAX_NO_ATTEMPTS = 5;
        
        let noAttempts = 0;
        let isYesClicked = false;
        let backgroundMusic = null;

        // Default settings
        let settings = {
            girlfriendName: 'Beautiful',
            boyfriendName: 'Your Valentine',
            finalMessage: 'üíñ I knew you would say yes! üíñ\nYou just made me the happiest person alive!'
        };

        // Parse URL parameters
        function parseURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const decoded = atob(dataParam);
                    const parsed = JSON.parse(decoded);
                    settings = { ...settings, ...parsed };
                } catch (e) {
                    console.error('Failed to parse URL parameters');
                }
            }
        }

        parseURLParams();

        // Elements
        const introOverlay = document.getElementById('introOverlay');
        const mainContent = document.getElementById('mainContent');
        const proposalText = document.getElementById('proposalText');
        const messageText = document.getElementById('messageText');
        const noButton = document.getElementById('noButton');
        const yesButton = document.getElementById('yesButton');
        const buttonContainer = document.getElementById('buttonContainer');
        const adminPanel = document.getElementById('adminPanel');
        const photoFrame = document.getElementById('photoFrame');

        // Initialize background music
        function initBackgroundMusic() {
            try {
                backgroundMusic = new Audio('/assets/forever.mp3');
                backgroundMusic.loop = true;
                backgroundMusic.volume = 0.3;
            } catch (e) {
                console.error('Failed to load background music:', e);
            }
        }

        // Start background music
        function startBackgroundMusic() {
            if (backgroundMusic) {
                backgroundMusic.play().catch(err => {
                    console.error('Failed to play background music:', err);
                });
            }
        }

        // Intro overlay click
        introOverlay.addEventListener('click', () => {
            introOverlay.classList.add('hidden');
            mainContent.classList.add('visible');
            initBackgroundMusic();
            startBackgroundMusic();
            startExperience();
        });

        // Background canvas animation
        const canvas = document.getElementById('backgroundCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const hearts = [];
        for (let i = 0; i < 30; i++) {
            hearts.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 20 + 10,
                speed: Math.random() * 0.5 + 0.2,
                opacity: Math.random() * 0.3 + 0.1
            });
        }

        function drawHeart(x, y, size) {
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.bezierCurveTo(x, y - size / 4, x - size / 2, y - size / 2, x - size / 2, y);
            ctx.bezierCurveTo(x - size / 2, y + size / 4, x, y + size / 2, x, y + size);
            ctx.bezierCurveTo(x, y + size / 2, x + size / 2, y + size / 4, x + size / 2, y);
            ctx.bezierCurveTo(x + size / 2, y - size / 2, x, y - size / 4, x, y);
            ctx.fill();
        }

        function animateHearts() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            hearts.forEach(heart => {
                ctx.fillStyle = `rgba(255, 182, 193, ${heart.opacity})`;
                drawHeart(heart.x, heart.y, heart.size);
                
                heart.y -= heart.speed;
                if (heart.y < -heart.size) {
                    heart.y = canvas.height + heart.size;
                    heart.x = Math.random() * canvas.width;
                }
            });
            
            requestAnimationFrame(animateHearts);
        }

        animateHearts();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Start experience
        function startExperience() {
            proposalText.textContent = `${settings.girlfriendName}, will you be my Valentine? üíï`;
            messageText.textContent = 'Choose wisely... üòä';
            positionNoButton();
        }

        // Position No button initially
        function positionNoButton() {
            const card = document.getElementById('mainCard');
            const cardRect = card.getBoundingClientRect();
            const buttonRect = noButton.getBoundingClientRect();
            
            const centerX = cardRect.left + (cardRect.width / 2) - (buttonRect.width / 2) - 100;
            const centerY = cardRect.top + cardRect.height - buttonRect.height - 40;
            
            noButton.style.left = `${centerX}px`;
            noButton.style.top = `${centerY}px`;
        }

        // Get safe random position for No button
        function getSafeRandomPosition() {
            const card = document.getElementById('mainCard');
            const cardRect = card.getBoundingClientRect();
            const buttonRect = noButton.getBoundingClientRect();
            
            const padding = 20;
            const minX = cardRect.left + padding;
            const maxX = cardRect.right - buttonRect.width - padding;
            const minY = cardRect.top + padding;
            const maxY = cardRect.bottom - buttonRect.height - padding;
            
            const viewportMinX = padding;
            const viewportMaxX = window.innerWidth - buttonRect.width - padding;
            const viewportMinY = padding;
            const viewportMaxY = window.innerHeight - buttonRect.height - padding;
            
            const finalMinX = Math.max(minX, viewportMinX);
            const finalMaxX = Math.min(maxX, viewportMaxX);
            const finalMinY = Math.max(minY, viewportMinY);
            const finalMaxY = Math.min(maxY, viewportMaxY);
            
            const newX = Math.random() * (finalMaxX - finalMinX) + finalMinX;
            const newY = Math.random() * (finalMaxY - finalMinY) + finalMinY;
            
            return { x: newX, y: newY };
        }

        // Handle No button interaction
        function handleNoButtonInteraction(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (isYesClicked) return;
            
            noAttempts++;
            
            const messages = [
                'Are you sure? ü•∫',
                'Really? Think again... üí≠',
                'Come on, give it a chance! üíù',
                'Pretty please? üôè',
                'Last chance to reconsider! ‚ú®'
            ];
            
            if (noAttempts < MAX_NO_ATTEMPTS) {
                messageText.textContent = messages[noAttempts - 1];
                const pos = getSafeRandomPosition();
                noButton.style.left = `${pos.x}px`;
                noButton.style.top = `${pos.y}px`;
            } else {
                noButton.style.display = 'none';
                yesButton.classList.add('visible');
                messageText.textContent = 'Okay, I guess there\'s only one option left... üòä';
            }
            
            createFloatingHeart(e.clientX || (e.touches && e.touches[0].clientX), 
                               e.clientY || (e.touches && e.touches[0].clientY));
        }

        noButton.addEventListener('mouseenter', handleNoButtonInteraction);
        noButton.addEventListener('touchstart', handleNoButtonInteraction);
        noButton.addEventListener('click', handleNoButtonInteraction);

        // Handle Yes button click
        yesButton.addEventListener('click', () => {
            if (isYesClicked) return;
            isYesClicked = true;
            
            noButton.style.display = 'none';
            yesButton.style.display = 'none';
            
            proposalText.innerHTML = settings.finalMessage.replace(/\n/g, '<br>');
            proposalText.classList.add('final-message');
            messageText.textContent = '';
            
            // Show photo frame
            photoFrame.classList.add('visible');
            
            createCelebration();
        });

        // Create floating heart
        function createFloatingHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'floating-decoration';
            heart.textContent = 'üíñ';
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;
            document.body.appendChild(heart);
            
            setTimeout(() => heart.remove(), 3000);
        }

        // Create celebration
        function createCelebration() {
            const emojis = ['üíñ', 'üíï', 'üíó', 'üíì', 'üíù', 'üåπ', '‚ú®', 'üéâ'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const emoji = document.createElement('div');
                    emoji.className = 'floating-decoration';
                    emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    emoji.style.left = `${Math.random() * window.innerWidth}px`;
                    emoji.style.top = `${window.innerHeight}px`;
                    emoji.style.fontSize = `${Math.random() * 2 + 2}rem`;
                    document.body.appendChild(emoji);
                    
                    setTimeout(() => emoji.remove(), 3000);
                }, i * 100);
            }
        }

        // Admin panel
        let adminClickCount = 0;
        let adminClickTimer = null;

        proposalText.addEventListener('click', () => {
            adminClickCount++;
            
            if (adminClickTimer) clearTimeout(adminClickTimer);
            
            if (adminClickCount >= 5) {
                adminPanel.classList.add('visible');
                adminClickCount = 0;
            }
            
            adminClickTimer = setTimeout(() => {
                adminClickCount = 0;
            }, 2000);
        });

        document.getElementById('closeAdmin').addEventListener('click', () => {
            adminPanel.classList.remove('visible');
        });

        document.getElementById('saveSettings').addEventListener('click', () => {
            const password = document.getElementById('adminPassword').value;
            
            if (password !== ADMIN_PASSWORD) {
                alert('Incorrect password!');
                return;
            }
            
            settings.girlfriendName = document.getElementById('adminGirlfriendName').value || settings.girlfriendName;
            settings.boyfriendName = document.getElementById('adminBoyfriendName').value || settings.boyfriendName;
            settings.finalMessage = document.getElementById('adminFinalMessage').value || settings.finalMessage;
            
            alert('Settings saved! Reload the page to see changes.');
        });

        document.getElementById('generateLink').addEventListener('click', () => {
            const password = document.getElementById('adminPassword').value;
            
            if (password !== ADMIN_PASSWORD) {
                alert('Incorrect password!');
                return;
            }
            
            const data = {
                girlfriendName: document.getElementById('adminGirlfriendName').value || settings.girlfriendName,
                boyfriendName: document.getElementById('adminBoyfriendName').value || settings.boyfriendName,
                finalMessage: document.getElementById('adminFinalMessage').value || settings.finalMessage
            };
            
            const encoded = btoa(JSON.stringify(data));
            const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
            
            const container = document.getElementById('shareLinkContainer');
            container.innerHTML = `<div class="share-link">${url}</div>`;
        });

        // Initialize admin fields
        document.getElementById('adminGirlfriendName').value = settings.girlfriendName;
        document.getElementById('adminBoyfriendName').value = settings.boyfriendName;
        document.getElementById('adminFinalMessage').value = settings.finalMessage;
    </script>
</body>
</html>
