<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Will You Be My Valentine? üíñ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, 
                oklch(0.25 0.15 320) 0%,
                oklch(0.35 0.18 340) 25%,
                oklch(0.45 0.12 350) 50%,
                oklch(0.35 0.15 330) 75%,
                oklch(0.25 0.12 310) 100%
            );
            position: relative;
            touch-action: pan-y;
            overscroll-behavior: none;
        }

        #backgroundCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* Corner Picture */
        #cornerPicture {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid oklch(0.95 0.05 340 / 0.5);
            box-shadow: 0 4px 20px oklch(0.3 0.1 340 / 0.4);
            z-index: 5;
            pointer-events: none;
            display: none;
        }

        #cornerPicture.visible {
            display: block;
        }

        /* Valentine Decorations */
        .cat-decoration {
            position: fixed;
            bottom: 20px;
            width: 80px;
            height: 80px;
            z-index: 5;
            pointer-events: none;
            animation: catBounce 3s ease-in-out infinite;
        }

        .cat-left {
            left: 20px;
        }

        .cat-right {
            right: 140px;
        }

        @keyframes catBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .chocolate-decoration {
            position: fixed;
            width: 40px;
            height: 40px;
            z-index: 5;
            pointer-events: none;
            opacity: 0.8;
        }

        .chocolate-1 {
            top: 15%;
            left: 10%;
            animation: floatChocolate 8s ease-in-out infinite;
        }

        .chocolate-2 {
            top: 25%;
            right: 15%;
            animation: floatChocolate 10s ease-in-out infinite 2s;
        }

        .chocolate-3 {
            bottom: 30%;
            left: 8%;
            animation: floatChocolate 12s ease-in-out infinite 4s;
        }

        @keyframes floatChocolate {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, -20px) rotate(90deg); }
            50% { transform: translate(0, -40px) rotate(180deg); }
            75% { transform: translate(-20px, -20px) rotate(270deg); }
        }

        .teddy-decoration {
            position: fixed;
            top: 10%;
            right: 5%;
            width: 100px;
            height: 100px;
            z-index: 5;
            pointer-events: none;
            animation: teddyHug 4s ease-in-out infinite;
        }

        @keyframes teddyHug {
            0%, 100% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }

        #introOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, 
                oklch(0.2 0.18 320) 0%,
                oklch(0.3 0.2 340) 50%,
                oklch(0.2 0.15 310) 100%
            );
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
            transition: opacity 1s ease-out;
        }

        #introOverlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .intro-text {
            font-size: clamp(2rem, 6vw, 4rem);
            color: oklch(0.95 0.05 340);
            text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8),
                         0 0 60px oklch(0.6 0.25 330 / 0.6);
            animation: pulse 2s ease-in-out infinite;
            font-weight: 300;
            letter-spacing: 0.05em;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        #mainContent {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease-in;
            touch-action: none;
        }

        #mainContent.visible {
            opacity: 1;
        }

        .glass-card {
            background: oklch(0.95 0.02 340 / 0.15);
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid oklch(0.95 0.05 340 / 0.3);
            border-radius: 32px;
            padding: clamp(2rem, 5vw, 4rem);
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.4),
                        0 0 80px oklch(0.5 0.2 340 / 0.2),
                        inset 0 1px 0 oklch(1 0 0 / 0.2);
            max-width: 90%;
            width: 500px;
            text-align: center;
            position: relative;
            animation: cardGlow 3s ease-in-out infinite;
        }

        @keyframes cardGlow {
            0%, 100% { box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.4),
                        0 0 80px oklch(0.5 0.2 340 / 0.2),
                        inset 0 1px 0 oklch(1 0 0 / 0.2); }
            50% { box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.5),
                        0 0 100px oklch(0.5 0.25 340 / 0.3),
                        inset 0 1px 0 oklch(1 0 0 / 0.3); }
        }

        .proposal-text {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: oklch(0.98 0.03 340);
            margin-bottom: 2rem;
            font-weight: 300;
            text-shadow: 0 2px 20px oklch(0.5 0.2 340 / 0.5);
            line-height: 1.4;
        }

        .message-text {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            color: oklch(0.85 0.08 340);
            margin-bottom: 2rem;
            min-height: 2em;
            font-weight: 400;
            text-shadow: 0 1px 10px oklch(0.5 0.15 340 / 0.4);
        }

        .button-container {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            min-height: 80px;
        }

        .btn {
            padding: 1rem 3rem;
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px oklch(0.3 0.1 340 / 0.3);
            position: relative;
            letter-spacing: 0.02em;
            touch-action: none;
        }

        .btn-no {
            background: linear-gradient(135deg, oklch(0.65 0.15 340), oklch(0.55 0.18 330));
            color: oklch(0.98 0.02 340);
            position: fixed;
            transition: left 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                        top 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            will-change: left, top;
            z-index: 100;
        }

        .btn-no:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px oklch(0.5 0.2 340 / 0.5);
        }

        .btn-yes {
            background: linear-gradient(135deg, oklch(0.7 0.2 340), oklch(0.6 0.25 350));
            color: oklch(0.98 0.02 340);
            opacity: 0;
            transform: scale(0);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .btn-yes.visible {
            opacity: 1;
            transform: scale(1);
        }

        .btn-yes:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 40px oklch(0.6 0.25 340 / 0.6);
        }

        .boba-input {
            width: 100%;
            max-width: 300px;
            padding: 0.8rem;
            font-size: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
            border-radius: 12px;
            background: oklch(0.98 0.01 340 / 0.8);
            color: oklch(0.2 0.1 340);
            margin-bottom: 1rem;
        }

        .final-message {
            font-size: clamp(1.3rem, 3.5vw, 2rem);
            color: oklch(0.98 0.03 340);
            text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8);
            animation: sparkle 2s ease-in-out infinite;
            line-height: 1.6;
        }

        @keyframes sparkle {
            0%, 100% { text-shadow: 0 0 30px oklch(0.7 0.2 340 / 0.8); }
            50% { text-shadow: 0 0 50px oklch(0.7 0.25 340 / 1); }
        }

        .floating-decoration {
            position: fixed;
            font-size: 3rem;
            pointer-events: none;
            z-index: 5;
            animation: floatUp 3s ease-out forwards;
            opacity: 0;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) rotate(0deg); }
            100% { opacity: 0; transform: translateY(-200px) rotate(360deg); }
        }

        #adminPanel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: oklch(0.95 0.02 340 / 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid oklch(0.95 0.05 340 / 0.5);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.6);
            z-index: 2000;
            display: none;
            max-width: 90%;
            width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        #adminPanel.visible {
            display: block;
        }

        .admin-title {
            font-size: 1.8rem;
            color: oklch(0.3 0.15 340);
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .admin-field {
            margin-bottom: 1.5rem;
        }

        .admin-label {
            display: block;
            font-size: 1rem;
            color: oklch(0.4 0.12 340);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .admin-input {
            width: 100%;
            padding: 0.8rem;
            font-size: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
            border-radius: 12px;
            background: oklch(0.98 0.01 340 / 0.8);
            color: oklch(0.2 0.1 340);
        }

        .admin-button {
            padding: 0.8rem 2rem;
            font-size: 1rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 1rem;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }

        .admin-button-primary {
            background: linear-gradient(135deg, oklch(0.65 0.2 340), oklch(0.55 0.25 330));
            color: oklch(0.98 0.02 340);
        }

        .admin-button-secondary {
            background: oklch(0.85 0.05 340);
            color: oklch(0.3 0.15 340);
        }

        .admin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px oklch(0.5 0.2 340 / 0.4);
        }

        .share-link {
            background: oklch(0.95 0.02 340);
            padding: 0.8rem;
            border-radius: 8px;
            word-break: break-all;
            font-size: 0.9rem;
            color: oklch(0.3 0.12 340);
            margin-top: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
        }

        .responses-list {
            margin-top: 2rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .response-item {
            background: oklch(0.98 0.01 340 / 0.8);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid oklch(0.7 0.05 340 / 0.3);
        }

        .response-item p {
            margin: 0.5rem 0;
            color: oklch(0.3 0.12 340);
            font-size: 0.9rem;
        }

        .response-item strong {
            color: oklch(0.2 0.15 340);
        }

        .empty-state {
            text-align: center;
            color: oklch(0.5 0.1 340);
            padding: 2rem;
            font-style: italic;
        }

        .error-message {
            color: oklch(0.5 0.2 10);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        #adminLogin {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: oklch(0.95 0.02 340 / 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid oklch(0.95 0.05 340 / 0.5);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 32px oklch(0.1 0.1 320 / 0.6);
            z-index: 2000;
            display: none;
            max-width: 90%;
            width: 400px;
        }

        #adminLogin.visible {
            display: block;
        }

        @media (max-width: 600px) {
            .glass-card {
                padding: 2rem 1.5rem;
            }
            
            .button-container {
                flex-direction: column;
                gap: 1rem;
                min-height: 100px;
            }

            .btn {
                width: 100%;
                max-width: 250px;
            }

            .cat-decoration {
                width: 60px;
                height: 60px;
            }

            .teddy-decoration {
                width: 70px;
                height: 70px;
            }

            .chocolate-decoration {
                width: 30px;
                height: 30px;
            }

            #cornerPicture {
                width: 70px;
                height: 70px;
                bottom: 10px;
                right: 10px;
            }

            .cat-right {
                right: 90px;
            }
        }
    </style>
</head>
<body>
    <canvas id="backgroundCanvas"></canvas>
    
    <!-- Corner Picture -->
    <img id="cornerPicture" src="" alt="Corner decoration" />
    
    <!-- Valentine Decorations -->
    <svg class="cat-decoration cat-left" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="catGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:oklch(0.75 0.15 30);stop-opacity:1" />
                <stop offset="100%" style="stop-color:oklch(0.65 0.18 25);stop-opacity:1" />
            </linearGradient>
        </defs>
        <ellipse cx="50" cy="60" rx="25" ry="20" fill="url(#catGradient)"/>
        <circle cx="50" cy="35" r="18" fill="url(#catGradient)"/>
        <path d="M 35 25 L 30 15 L 40 20 Z" fill="url(#catGradient)"/>
        <path d="M 65 25 L 70 15 L 60 20 Z" fill="url(#catGradient)"/>
        <circle cx="43" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="57" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="50" cy="40" r="2" fill="oklch(0.6 0.2 10)"/>
        <line x1="30" y1="38" x2="20" y2="36" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <line x1="30" y1="42" x2="20" y2="44" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <line x1="70" y1="38" x2="80" y2="36" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <line x1="70" y1="42" x2="80" y2="44" stroke="oklch(0.3 0.1 30)" stroke-width="1"/>
        <path d="M 70 65 Q 85 60 90 70" stroke="url(#catGradient)" stroke-width="4" fill="none" stroke-linecap="round"/>
    </svg>

    <svg class="cat-decoration cat-right" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="catGradient2" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:oklch(0.8 0.12 340);stop-opacity:1" />
                <stop offset="100%" style="stop-color:oklch(0.7 0.15 335);stop-opacity:1" />
            </linearGradient>
        </defs>
        <ellipse cx="50" cy="60" rx="25" ry="20" fill="url(#catGradient2)"/>
        <circle cx="50" cy="35" r="18" fill="url(#catGradient2)"/>
        <path d="M 35 25 L 30 15 L 40 20 Z" fill="url(#catGradient2)"/>
        <path d="M 65 25 L 70 15 L 60 20 Z" fill="url(#catGradient2)"/>
        <circle cx="43" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="57" cy="33" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="50" cy="40" r="2" fill="oklch(0.6 0.2 10)"/>
        <line x1="30" y1="38" x2="20" y2="36" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <line x1="30" y1="42" x2="20" y2="44" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <line x1="70" y1="38" x2="80" y2="36" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <line x1="70" y1="42" x2="80" y2="44" stroke="oklch(0.3 0.1 340)" stroke-width="1"/>
        <path d="M 30 65 Q 15 60 10 70" stroke="url(#catGradient2)" stroke-width="4" fill="none" stroke-linecap="round"/>
    </svg>

    <svg class="chocolate-decoration chocolate-1" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="10" width="40" height="30" rx="5" fill="oklch(0.35 0.08 30)"/>
        <rect x="10" y="15" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
        <rect x="27" y="15" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
        <rect x="10" y="27" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
        <rect x="27" y="27" width="15" height="10" fill="oklch(0.45 0.1 35)"/>
    </svg>

    <svg class="chocolate-decoration chocolate-2" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <circle cx="25" cy="25" r="20" fill="oklch(0.4 0.1 25)"/>
        <circle cx="25" cy="25" r="15" fill="oklch(0.5 0.12 30)"/>
        <path d="M 25 10 L 28 20 L 38 20 L 30 27 L 33 37 L 25 30 L 17 37 L 20 27 L 12 20 L 22 20 Z" fill="oklch(0.95 0.02 340)"/>
    </svg>

    <svg class="chocolate-decoration chocolate-3" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
        <rect x="10" y="15" width="30" height="20" rx="3" fill="oklch(0.4 0.1 30)"/>
        <circle cx="20" cy="25" r="5" fill="oklch(0.5 0.12 35)"/>
        <circle cx="30" cy="25" r="5" fill="oklch(0.5 0.12 35)"/>
    </svg>

    <svg class="teddy-decoration" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <defs>
            <linearGradient id="teddyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:oklch(0.6 0.08 30);stop-opacity:1" />
                <stop offset="100%" style="stop-color:oklch(0.5 0.1 25);stop-opacity:1" />
            </linearGradient>
        </defs>
        <circle cx="30" cy="30" r="15" fill="url(#teddyGradient)"/>
        <circle cx="70" cy="30" r="15" fill="url(#teddyGradient)"/>
        <ellipse cx="50" cy="55" rx="28" ry="32" fill="url(#teddyGradient)"/>
        <circle cx="50" cy="40" r="22" fill="url(#teddyGradient)"/>
        <circle cx="43" cy="38" r="3" fill="oklch(0.2 0.05 340)"/>
        <circle cx="57" cy="38" r="3" fill="oklch(0.2 0.05 340)"/>
        <ellipse cx="50" cy="48" rx="8" ry="6" fill="oklch(0.4 0.08 25)"/>
        <path d="M 50 48 Q 50 52 50 54" stroke="oklch(0.3 0.1 30)" stroke-width="2" fill="none"/>
        <path d="M 50 54 Q 45 56 42 54" stroke="oklch(0.3 0.1 30)" stroke-width="2" fill="none" stroke-linecap="round"/>
        <path d="M 50 54 Q 55 56 58 54" stroke="oklch(0.3 0.1 30)" stroke-width="2" fill="none" stroke-linecap="round"/>
        <path d="M 35 60 L 30 75 L 40 75 Z" fill="url(#teddyGradient)"/>
        <path d="M 65 60 L 70 75 L 60 75 Z" fill="url(#teddyGradient)"/>
        <ellipse cx="50" cy="62" rx="6" ry="4" fill="oklch(0.7 0.2 340)" opacity="0.6"/>
    </svg>

    <div id="introOverlay">
        <div class="intro-text">Click to Start üíñ</div>
    </div>

    <div id="mainContent">
        <div class="glass-card">
            <div class="proposal-text" id="proposalText">Will you marry me?</div>
            <div class="message-text" id="messageText"></div>
            <div class="button-container">
                <button class="btn btn-no" id="noBtn">No</button>
                <button class="btn btn-yes" id="yesBtn">Yes! üíï</button>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLogin">
        <h2 class="admin-title">Admin Login</h2>
        <div class="admin-field">
            <label class="admin-label" for="adminUsername">Username</label>
            <input type="text" id="adminUsername" class="admin-input" placeholder="Enter username">
        </div>
        <div class="admin-field">
            <label class="admin-label" for="adminPassword">Password</label>
            <input type="password" id="adminPassword" class="admin-input" placeholder="Enter password">
        </div>
        <div id="loginError" class="error-message" style="display: none;"></div>
        <button class="admin-button admin-button-primary" id="loginBtn">Login</button>
        <button class="admin-button admin-button-secondary" id="cancelLoginBtn">Cancel</button>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel">
        <h2 class="admin-title">Admin Panel</h2>
        
        <div class="admin-field">
            <label class="admin-label" for="bfName">Boyfriend Name</label>
            <input type="text" id="bfName" class="admin-input" placeholder="Enter boyfriend name">
        </div>
        
        <div class="admin-field">
            <label class="admin-label" for="gfName">Girlfriend Name</label>
            <input type="text" id="gfName" class="admin-input" placeholder="Enter girlfriend name">
        </div>
        
        <div class="admin-field">
            <label class="admin-label" for="mainMessage">Main Message</label>
            <input type="text" id="mainMessage" class="admin-input" placeholder="Enter main message">
        </div>
        
        <div class="admin-field">
            <label class="admin-label" for="cornerImageUrl">Corner Image URL</label>
            <input type="text" id="cornerImageUrl" class="admin-input" placeholder="Enter image URL">
        </div>
        
        <button class="admin-button admin-button-primary" id="saveBtn">Save Changes</button>
        <button class="admin-button admin-button-primary" id="generateLinkBtn">Generate Share Link</button>
        <button class="admin-button admin-button-secondary" id="closeAdminBtn">Close</button>
        
        <div id="shareLinkContainer" style="display: none;">
            <div class="share-link" id="shareLink"></div>
        </div>
        
        <div class="responses-list">
            <h3 class="admin-label">Responses</h3>
            <div id="responsesList"></div>
        </div>
    </div>

    <script type="module">
        import { recordResponse, isAdmin, getAllResponses } from './src/valentine/backendClient.ts';

        // State
        let noButtonMoveCount = 0;
        const MAX_NO_MOVES = 10;
        let currentAdminPassword = '';
        
        const apologyMessages = [
            "Please? ü•∫",
            "Are you sure? üíî",
            "Think about it... üí≠",
            "I'll be sad... üò¢",
            "Pretty please? üôè",
            "One more chance? üíù",
            "Don't break my heart... üíî",
            "I promise to be good! üòá",
            "You're making me cry... üò≠",
            "Last chance! üíñ"
        ];

        // Elements
        const introOverlay = document.getElementById('introOverlay');
        const mainContent = document.getElementById('mainContent');
        const noBtn = document.getElementById('noBtn');
        const yesBtn = document.getElementById('yesBtn');
        const proposalText = document.getElementById('proposalText');
        const messageText = document.getElementById('messageText');
        const cornerPicture = document.getElementById('cornerPicture');
        const adminPanel = document.getElementById('adminPanel');
        const adminLogin = document.getElementById('adminLogin');

        // Admin elements
        const bfNameInput = document.getElementById('bfName');
        const gfNameInput = document.getElementById('gfName');
        const mainMessageInput = document.getElementById('mainMessage');
        const cornerImageUrlInput = document.getElementById('cornerImageUrl');
        const saveBtn = document.getElementById('saveBtn');
        const generateLinkBtn = document.getElementById('generateLinkBtn');
        const closeAdminBtn = document.getElementById('closeAdminBtn');
        const shareLinkContainer = document.getElementById('shareLinkContainer');
        const shareLink = document.getElementById('shareLink');
        const responsesList = document.getElementById('responsesList');

        // Admin login elements
        const adminUsername = document.getElementById('adminUsername');
        const adminPassword = document.getElementById('adminPassword');
        const loginBtn = document.getElementById('loginBtn');
        const cancelLoginBtn = document.getElementById('cancelLoginBtn');
        const loginError = document.getElementById('loginError');

        // Audio
        let audio;

        // Canvas animation
        const canvas = document.getElementById('backgroundCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const hearts = [];
        for (let i = 0; i < 50; i++) {
            hearts.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 20 + 10,
                speed: Math.random() * 2 + 1,
                opacity: Math.random() * 0.5 + 0.3
            });
        }

        function drawHeart(x, y, size) {
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.bezierCurveTo(x, y - size / 4, x - size / 2, y - size / 2, x - size / 2, y);
            ctx.bezierCurveTo(x - size / 2, y + size / 4, x, y + size / 2, x, y + size);
            ctx.bezierCurveTo(x, y + size / 2, x + size / 2, y + size / 4, x + size / 2, y);
            ctx.bezierCurveTo(x + size / 2, y - size / 2, x, y - size / 4, x, y);
            ctx.fill();
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            hearts.forEach(heart => {
                ctx.fillStyle = `rgba(255, 182, 193, ${heart.opacity})`;
                drawHeart(heart.x, heart.y, heart.size);
                
                heart.y += heart.speed;
                if (heart.y > canvas.height + heart.size) {
                    heart.y = -heart.size;
                    heart.x = Math.random() * canvas.width;
                }
            });
            
            requestAnimationFrame(animate);
        }

        animate();

        // Clamp position within viewport bounds
        function clampPositionToViewport(button) {
            const rect = button.getBoundingClientRect();
            const buttonWidth = rect.width;
            const buttonHeight = rect.height;
            
            // Get current position
            let left = parseFloat(button.style.left) || rect.left;
            let top = parseFloat(button.style.top) || rect.top;
            
            // Clamp to viewport bounds
            const maxLeft = window.innerWidth - buttonWidth;
            const maxTop = window.innerHeight - buttonHeight;
            
            left = Math.max(0, Math.min(left, maxLeft));
            top = Math.max(0, Math.min(top, maxTop));
            
            return { left, top };
        }

        // Move No button to random position within viewport
        function moveNoButton() {
            if (noButtonMoveCount >= MAX_NO_MOVES) {
                return;
            }

            const rect = noBtn.getBoundingClientRect();
            const buttonWidth = rect.width;
            const buttonHeight = rect.height;
            
            // Calculate safe bounds
            const maxLeft = window.innerWidth - buttonWidth;
            const maxTop = window.innerHeight - buttonHeight;
            
            // Generate random position within safe bounds
            const newLeft = Math.random() * maxLeft;
            const newTop = Math.random() * maxTop;
            
            noBtn.style.left = `${newLeft}px`;
            noBtn.style.top = `${newTop}px`;
            
            noButtonMoveCount++;
            
            if (noButtonMoveCount < apologyMessages.length) {
                messageText.textContent = apologyMessages[noButtonMoveCount];
            }
            
            if (noButtonMoveCount >= MAX_NO_MOVES) {
                yesBtn.classList.add('visible');
            }
        }

        // Handle viewport resize/orientation change
        function handleResize() {
            const clamped = clampPositionToViewport(noBtn);
            noBtn.style.left = `${clamped.left}px`;
            noBtn.style.top = `${clamped.top}px`;
            
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Initialize No button position
        function initializeNoButton() {
            const rect = noBtn.getBoundingClientRect();
            noBtn.style.left = `${rect.left}px`;
            noBtn.style.top = `${rect.top}px`;
        }

        // Intro overlay click
        introOverlay.addEventListener('click', () => {
            introOverlay.classList.add('hidden');
            mainContent.classList.add('visible');
            
            // Play audio
            audio = new Audio('/assets/forever.mp3');
            audio.loop = true;
            audio.play().catch(e => console.log('Audio autoplay prevented'));
            
            // Initialize No button position
            setTimeout(initializeNoButton, 100);
        });

        // No button hover/touch
        noBtn.addEventListener('mouseenter', moveNoButton);
        noBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            moveNoButton();
        });

        // Yes button click
        yesBtn.addEventListener('click', async () => {
            proposalText.textContent = "üíñ Yay! You said yes! üíñ";
            messageText.textContent = "Now, one more question...";
            noBtn.style.display = 'none';
            yesBtn.style.display = 'none';
            
            setTimeout(() => {
                proposalText.textContent = "What's your favorite boba tea flavor?";
                messageText.innerHTML = '<input type="text" class="boba-input" id="bobaInput" placeholder="Type your answer...">';
                
                const bobaInput = document.getElementById('bobaInput');
                const submitBobaBtn = document.createElement('button');
                submitBobaBtn.className = 'btn btn-yes visible';
                submitBobaBtn.textContent = 'Submit';
                submitBobaBtn.style.display = 'inline-block';
                
                document.querySelector('.button-container').appendChild(submitBobaBtn);
                
                submitBobaBtn.addEventListener('click', async () => {
                    const bobaAnswer = bobaInput.value.trim();
                    if (bobaAnswer) {
                        try {
                            await recordResponse('Yes', bobaAnswer);
                        } catch (error) {
                            console.error('Error recording response:', error);
                        }
                        
                        proposalText.innerHTML = '<div class="final-message">Perfect! üíï<br>See you soon! ü•∞</div>';
                        messageText.textContent = '';
                        submitBobaBtn.style.display = 'none';
                        
                        createFloatingDecorations();
                    }
                });
            }, 2000);
        });

        function createFloatingDecorations() {
            const emojis = ['üíñ', 'üíï', 'üíó', 'üíù', 'üíò', 'ü•∞', 'üòç', 'üíë'];
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const decoration = document.createElement('div');
                    decoration.className = 'floating-decoration';
                    decoration.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    decoration.style.left = Math.random() * window.innerWidth + 'px';
                    decoration.style.top = window.innerHeight + 'px';
                    document.body.appendChild(decoration);
                    
                    setTimeout(() => decoration.remove(), 3000);
                }, i * 200);
            }
        }

        // Load data from URL
        function loadDataFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('data');
            
            if (data) {
                try {
                    const decoded = JSON.parse(atob(data));
                    if (decoded.bf) bfNameInput.value = decoded.bf;
                    if (decoded.gf) gfNameInput.value = decoded.gf;
                    if (decoded.message) {
                        mainMessageInput.value = decoded.message;
                        proposalText.textContent = decoded.message;
                    }
                    if (decoded.image) {
                        cornerImageUrlInput.value = decoded.image;
                        cornerPicture.src = decoded.image;
                        cornerPicture.classList.add('visible');
                    }
                } catch (e) {
                    console.error('Error parsing URL data:', e);
                }
            }
        }

        // Admin login
        let adminClickCount = 0;
        let adminClickTimer = null;

        cornerPicture.addEventListener('click', () => {
            adminClickCount++;
            
            if (adminClickTimer) {
                clearTimeout(adminClickTimer);
            }
            
            if (adminClickCount >= 5) {
                adminLogin.classList.add('visible');
                adminClickCount = 0;
            }
            
            adminClickTimer = setTimeout(() => {
                adminClickCount = 0;
            }, 2000);
        });

        loginBtn.addEventListener('click', async () => {
            const username = adminUsername.value.trim();
            const password = adminPassword.value.trim();
            
            loginError.style.display = 'none';
            
            if (username !== 'akash') {
                loginError.textContent = 'Invalid username. Please try again.';
                loginError.style.display = 'block';
                return;
            }
            
            try {
                const isValidAdmin = await isAdmin(password);
                
                if (isValidAdmin) {
                    currentAdminPassword = password;
                    adminLogin.classList.remove('visible');
                    adminPanel.classList.add('visible');
                    loadResponses();
                    
                    // Clear login form
                    adminUsername.value = '';
                    adminPassword.value = '';
                } else {
                    loginError.textContent = 'Invalid password. Please try again.';
                    loginError.style.display = 'block';
                }
            } catch (error) {
                console.error('Login error:', error);
                loginError.textContent = 'Login failed. Please try again.';
                loginError.style.display = 'block';
            }
        });

        cancelLoginBtn.addEventListener('click', () => {
            adminLogin.classList.remove('visible');
            adminUsername.value = '';
            adminPassword.value = '';
            loginError.style.display = 'none';
        });

        // Allow Enter key to submit login
        adminPassword.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loginBtn.click();
            }
        });

        saveBtn.addEventListener('click', () => {
            const bf = bfNameInput.value.trim();
            const gf = gfNameInput.value.trim();
            const message = mainMessageInput.value.trim();
            const imageUrl = cornerImageUrlInput.value.trim();
            
            if (message) {
                proposalText.textContent = message;
            }
            
            if (imageUrl) {
                cornerPicture.src = imageUrl;
                cornerPicture.classList.add('visible');
            }
            
            alert('Changes saved successfully!');
        });

        generateLinkBtn.addEventListener('click', () => {
            const bf = bfNameInput.value.trim();
            const gf = gfNameInput.value.trim();
            const message = mainMessageInput.value.trim();
            const imageUrl = cornerImageUrlInput.value.trim();
            
            const data = {
                bf: bf || 'Boyfriend',
                gf: gf || 'Girlfriend',
                message: message || 'Will you marry me?',
                image: imageUrl || ''
            };
            
            const encoded = btoa(JSON.stringify(data));
            const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
            
            shareLink.textContent = url;
            shareLinkContainer.style.display = 'block';
            
            // Copy to clipboard
            navigator.clipboard.writeText(url).then(() => {
                alert('Link copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        });

        closeAdminBtn.addEventListener('click', () => {
            adminPanel.classList.remove('visible');
            currentAdminPassword = '';
        });

        async function loadResponses() {
            if (!currentAdminPassword) return;
            
            try {
                const responses = await getAllResponses(currentAdminPassword);
                
                if (!responses || responses.length === 0) {
                    responsesList.innerHTML = '<div class="empty-state">No responses yet</div>';
                    return;
                }
                
                responsesList.innerHTML = responses.map((response, index) => `
                    <div class="response-item">
                        <p><strong>Response ${index + 1}</strong></p>
                        <p><strong>Wedding:</strong> ${response.weddingAnswer}</p>
                        <p><strong>Boba:</strong> ${response.bobaAnswer}</p>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading responses:', error);
                responsesList.innerHTML = '<div class="empty-state">Error loading responses</div>';
            }
        }

        // Initialize
        loadDataFromURL();
    </script>
</body>
</html>
